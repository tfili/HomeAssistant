[{"id":"7bd9273e.d66c58","type":"tab","label":"Security","disabled":false,"info":""},{"id":"3624fd34.85cb02","type":"tab","label":"iOS Notifications","disabled":false,"info":""},{"id":"2262bac4.80fc86","type":"tab","label":"Hue Remote","disabled":false,"info":""},{"id":"7115eb23.9f0644","type":"tab","label":"Meeting","disabled":false,"info":""},{"id":"25d012a1.14593e","type":"tab","label":"Outside Lights","disabled":false,"info":""},{"id":"a3073265.18cb2","type":"tab","label":"Doorbell Ring","disabled":false,"info":""},{"id":"72891f2a.4e292","type":"subflow","name":"Close Garage Doors","info":"","category":"","in":[{"x":60,"y":100,"wires":[{"id":"7a72fec7.f54fe"},{"id":"e991ac67.bd98c"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"ebca2dd1.3553a","type":"subflow","name":"iRobot Prompt","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"15398f75.327181"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"697063ce.0b394c","type":"subflow","name":"Vacuum","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"66a0c76e.9814a8"}]}],"out":[{"x":1220,"y":60,"wires":[{"id":"c2a9ba6b.1a70b8","port":0}]},{"x":1440,"y":360,"wires":[{"id":"131b3cae.48f863","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"f8cf226d.22997","type":"subflow","name":"Mop","info":"","category":"","in":[{"x":60,"y":40,"wires":[{"id":"591d81fc.f6d56"}]}],"out":[{"x":1160,"y":60,"wires":[{"id":"dc5175ff.0fbe18","port":0}]},{"x":1380,"y":340,"wires":[{"id":"bba00f31.d2b09","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"6954ffe6.b584c","type":"server","name":"Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":false,"cacheJson":true},{"id":"58a14a8e.257e84","type":"mqtt-broker","name":"Mosquitto","broker":"core-mosquitto","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"fd5f08df.bdadb8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"9639d260.44a31","type":"switch","z":"7bd9273e.d66c58","name":"Task Processor","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"single","vt":"str"},{"t":"cont","v":"long","vt":"str"},{"t":"cont","v":"double","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":340,"y":860,"wires":[["7ed86bbb.256174"],["69d6b4bf.8eba8c"],["c5180f2d.025b3"]]},{"id":"7a72fec7.f54fe","type":"api-current-state","z":"72891f2a.4e292","name":"Is left garage door open","server":"6954ffe6.b584c","version":1,"outputs":2,"halt_if":"open","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"cover.left_garage_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":60,"wires":[["a030aa94.31bc38"],[]]},{"id":"a030aa94.31bc38","type":"api-call-service","z":"72891f2a.4e292","name":"Close left garage door","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"cover","service":"close_cover","entityId":"cover.left_garage_door","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":520,"y":40,"wires":[[]]},{"id":"e991ac67.bd98c","type":"api-current-state","z":"72891f2a.4e292","name":"Is right garage door open","server":"6954ffe6.b584c","version":1,"outputs":2,"halt_if":"open","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"cover.right_garage_door","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":250,"y":140,"wires":[["f5a03378.0c829"],[]]},{"id":"f5a03378.0c829","type":"api-call-service","z":"72891f2a.4e292","name":"Close right garage door","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"cover","service":"close_cover","entityId":"cover.right_garage_door","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":530,"y":120,"wires":[[]]},{"id":"da07ef72.66701","type":"mqtt in","z":"2262bac4.80fc86","name":"","topic":"zigbee2mqtt/Remote/action","qos":"2","datatype":"utf8","broker":"58a14a8e.257e84","x":150,"y":140,"wires":[["9e7302f5.911ac"]]},{"id":"9e7302f5.911ac","type":"switch","z":"2262bac4.80fc86","name":"Remote actions","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"(on-press|on-hold-release)","vt":"str","case":false},{"t":"regex","v":"(up-press|up-hold)","vt":"str","case":false},{"t":"regex","v":"(down-press|down-hold)","vt":"str","case":false},{"t":"regex","v":"(off-press|off-hold-release)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":4,"x":424,"y":140,"wires":[["ea5775a9.653028"],["c76e7cf5.da5ee"],["95a0d9c9.601718"],["6f68072f.169a88"]]},{"id":"ea5775a9.653028","type":"api-call-service","z":"2262bac4.80fc86","name":"Turn on","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":724,"y":40,"wires":[[]]},{"id":"6f68072f.169a88","type":"api-call-service","z":"2262bac4.80fc86","name":"Turn off","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.cabinet","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":724,"y":240,"wires":[[]]},{"id":"c76e7cf5.da5ee","type":"api-call-service","z":"2262bac4.80fc86","name":"Increase","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet","data":"{ \"brightness_step_pct\": 10 }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":724,"y":100,"wires":[[]]},{"id":"95a0d9c9.601718","type":"api-call-service","z":"2262bac4.80fc86","name":"Decrease","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet","data":"{ \"brightness_step_pct\": -10 }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":724,"y":180,"wires":[[]]},{"id":"78c827c0.a3b928","type":"server-events","z":"ebca2dd1.3553a","name":"ios Action","server":"6954ffe6.b584c","event_type":"ios.notification_action_fired","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":80,"y":340,"wires":[["5d7268ab.c17248"]]},{"id":"5d7268ab.c17248","type":"switch","z":"ebca2dd1.3553a","name":"iRobot Command","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"VACUUM_AND_MOP","vt":"str"},{"t":"eq","v":"VACUUM","vt":"str"},{"t":"eq","v":"VACUUM_SELECTED","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":190,"y":460,"wires":[["d0ab445a.f183b8"],["a6f6dae3.c814a8"],["9899edf1.51fc9"]]},{"id":"15398f75.327181","type":"api-call-service","z":"ebca2dd1.3553a","name":"Prompt","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_toms_iphone","entityId":"","data":"{\"title\":\"Alarm Armed\",\"message\":\"What do you want to clean?\",\"data\":{\"push\":{\"category\":\"vacuum\"}}}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":280,"y":60,"wires":[[]]},{"id":"dcfb88a8.58b7c8","type":"api-call-service","z":"ebca2dd1.3553a","name":"Vacuum Selected Rooms","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"automation","service":"trigger","entityId":"automation.vacuum_clean_rooms","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":470,"y":680,"wires":[["933367dd.9447f8"]]},{"id":"55beadbf.5f9164","type":"ha-wait-until","z":"ebca2dd1.3553a","name":"Wait till vacuum is done","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.vacuum","entityIdFilterType":"exact","property":"state","comparator":"is","value":"Ready","valueType":"str","timeout":"4","timeoutType":"num","timeoutUnits":"hours","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":1010,"y":640,"wires":[["c67c5974.ce61c8"],["aac1bb26.b1fb08"]]},{"id":"b239385e.cc1ef8","type":"api-call-service","z":"f8cf226d.22997","name":"Mop","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"mop_action","entityId":"","data":"{\"command\": \"start\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":390,"y":160,"wires":[["6d5643b1.6284ec"]]},{"id":"c2a9ba6b.1a70b8","type":"ha-wait-until","z":"697063ce.0b394c","name":"Wait till vacuum is done","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.vacuum","entityIdFilterType":"exact","property":"state","comparator":"is","value":"Ready","valueType":"str","timeout":"4","timeoutType":"num","timeoutUnits":"hours","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":1010,"y":80,"wires":[[],["131b3cae.48f863"]]},{"id":"aac1bb26.b1fb08","type":"api-call-service","z":"ebca2dd1.3553a","name":"Vacuum return home","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"vacuum_action","entityId":"","data":"{\"command\": \"dock\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1300,"y":740,"wires":[["f6e3200c.a8995"]]},{"id":"dc5175ff.0fbe18","type":"ha-wait-until","z":"f8cf226d.22997","name":"Wait till mop is done","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.mop","entityIdFilterType":"exact","property":"state","comparator":"is","value":"Ready","valueType":"str","timeout":"3","timeoutType":"num","timeoutUnits":"hours","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":960,"y":80,"wires":[[],["bba00f31.d2b09"]]},{"id":"bba00f31.d2b09","type":"api-call-service","z":"f8cf226d.22997","name":"Mop return home","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"mop_action","entityId":"","data":"{\"command\": \"dock\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1210,"y":340,"wires":[[]]},{"id":"66a0c76e.9814a8","type":"api-call-service","z":"697063ce.0b394c","name":"Turn on lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet, light.kitchen_dimmer","data":"{ \"brightness_pct\": 50 }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":180,"y":40,"wires":[["9de72cf8.c370e"]]},{"id":"9899edf1.51fc9","type":"api-call-service","z":"ebca2dd1.3553a","name":"Turn on lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet, light.kitchen_dimmer","data":"{ \"brightness_pct\": 50 }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":240,"y":680,"wires":[["dcfb88a8.58b7c8"]]},{"id":"c67c5974.ce61c8","type":"api-call-service","z":"ebca2dd1.3553a","name":"Turn off lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.cabinet, light.kitchen_dimmer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1400,"y":500,"wires":[[]]},{"id":"f6e3200c.a8995","type":"delay","z":"ebca2dd1.3553a","name":"Wait 10 minutes","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":940,"y":500,"wires":[["c67c5974.ce61c8"]]},{"id":"7c227fd9.abce7","type":"ha-zone","z":"7bd9273e.d66c58","server":"6954ffe6.b584c","name":"Auto Home","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entities":["person.tom_fili","person.jami_fili"],"event":"enter","zones":["zone.auto_home"],"x":90,"y":40,"wires":[["66af39c3.26f6a8"]]},{"id":"3677d4d3.bb0a4c","type":"bigtimer","z":"25d012a1.14593e","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer","comment":"","lat":"40.2581","lon":"-75.7263","starttime":"5004","endtime":"5003","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":"","xmonth7":"","xday8":"","xmonth8":"","xday9":"","xmonth9":"","xday10":"","xmonth10":"","xday11":"","xmonth11":"","xday12":"","xmonth12":"","xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":120,"y":100,"wires":[[],[],["3e308796.ca5c38"]]},{"id":"3e308796.ca5c38","type":"switch","z":"25d012a1.14593e","name":"on/off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":340,"y":100,"wires":[["82787397.1d76c"],["899db591.0b1738"]]},{"id":"82787397.1d76c","type":"api-call-service","z":"25d012a1.14593e","name":"Turn on lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.porch_lights, switch.driveway_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":60,"wires":[[]]},{"id":"899db591.0b1738","type":"api-call-service","z":"25d012a1.14593e","name":"Turn off lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.porch_lights, switch.driveway_lights","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":140,"wires":[[]]},{"id":"77d9401f.5c397","type":"server-state-changed","z":"7115eb23.9f0644","name":"Cesium Meeting","server":"6954ffe6.b584c","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"calendar.tom_cesium_com","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"x":120,"y":140,"wires":[["c94bd218.f1f8","df85a048.26658"],[]]},{"id":"c94bd218.f1f8","type":"api-call-service","z":"7115eb23.9f0644","name":"Alert","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"tts","service":"google_translate_say","entityId":"media_player.office_display","data":"{\"message\":$$.data.new_state.attributes.message}","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":340,"y":100,"wires":[[]]},{"id":"df85a048.26658","type":"api-call-service","z":"7115eb23.9f0644","name":"Mute","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_mute","entityId":"media_player.office_tv","data":"{\"is_volume_muted\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":340,"y":180,"wires":[[]]},{"id":"c226b0f6.a34c2","type":"inject","z":"7115eb23.9f0644","name":"Test Meeting","props":[{"p":"payload"},{"p":"data","v":"{\"new_state\":{\"attributes\":{\"message\":\"This is a meeting test\"}}}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":130,"y":40,"wires":[[]]},{"id":"45bf4987.3fc5f8","type":"server-state-changed","z":"7bd9273e.d66c58","name":"Button Click","server":"6954ffe6.b584c","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor\\..+_bedroom_button_action","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"single,double,long","halt_if_type":"str","halt_if_compare":"includes","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":90,"y":860,"wires":[["9639d260.44a31"],[]]},{"id":"7ed86bbb.256174","type":"api-call-service","z":"7bd9273e.d66c58","name":"Toggle bedroom lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"switch","service":"toggle","entityId":"switch.jamis_bedside_lamp, switch.toms_bedside_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":617,"y":780,"wires":[[]]},{"id":"cad3b9bc.438b08","type":"server-events","z":"3624fd34.85cb02","name":"ios Action","server":"6954ffe6.b584c","event_type":"ios.notification_action_fired","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":120,"y":140,"wires":[["65dfeb32.ebc3f4"]]},{"id":"65dfeb32.ebc3f4","type":"switch","z":"3624fd34.85cb02","name":"Action","property":"payload.event.actionName","propertyType":"msg","rules":[{"t":"eq","v":"GARAGE_CLOSE","vt":"str"},{"t":"eq","v":"DISMISS_ALERT","vt":"str"},{"t":"eq","v":"ALARM_ARM","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":310,"y":140,"wires":[["50395c84.e00bb4"],["b1a16b16.ed2558"],["31a09e5c.f51442"]]},{"id":"50395c84.e00bb4","type":"subflow:72891f2a.4e292","z":"3624fd34.85cb02","name":"","env":[],"x":560,"y":60,"wires":[]},{"id":"b1a16b16.ed2558","type":"api-call-service","z":"3624fd34.85cb02","name":"Dismiss Alert","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"alert","service":"turn_off","entityId":"","data":"{ \"entity_id\": $$.payload.event.action_data.entity_id}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":530,"y":140,"wires":[[]]},{"id":"933367dd.9447f8","type":"ha-wait-until","z":"ebca2dd1.3553a","name":"Wait till vacuum started","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.vacuum","entityIdFilterType":"exact","property":"state","comparator":"is_not","value":"Ready","valueType":"str","timeout":"5","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":750,"y":680,"wires":[["55beadbf.5f9164"],["aac1bb26.b1fb08"]]},{"id":"ece4f7a6.692888","type":"ha-wait-until","z":"697063ce.0b394c","name":"Wait till vacuum started","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.vacuum","entityIdFilterType":"exact","property":"state","comparator":"is_not","value":"Ready","valueType":"str","timeout":"5","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":710,"y":160,"wires":[["c2a9ba6b.1a70b8"],["131b3cae.48f863"]]},{"id":"6d5643b1.6284ec","type":"ha-wait-until","z":"f8cf226d.22997","name":"Wait till mop started","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.mop","entityIdFilterType":"exact","property":"state","comparator":"is_not","value":"Ready","valueType":"str","timeout":"5","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":710,"y":160,"wires":[["dc5175ff.0fbe18"],["bba00f31.d2b09"]]},{"id":"4ffb921f.584bdc","type":"api-call-service","z":"697063ce.0b394c","name":"Vacuum","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"vacuum_action","entityId":"","data":"{\"command\": \"start\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":380,"y":160,"wires":[["ece4f7a6.692888"]]},{"id":"79674ef0.cfdc5","type":"server-events","z":"a3073265.18cb2","name":"Nest Event","server":"6954ffe6.b584c","event_type":"nest_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":120,"y":100,"wires":[["72a84563.c2fe6c"]]},{"id":"e948afde.d49af","type":"api-call-service","z":"a3073265.18cb2","name":"Alexa notify","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"notify","service":"alexa_media","entityId":"","data":"{\"message\":\"Someone is at the front door\",\"data\":{\"type\":\"tts\"},\"target\":[\"media_player.kitchen_alexa\"]}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":200,"wires":[[]]},{"id":"97824373.fa92f","type":"api-call-service","z":"a3073265.18cb2","name":"Google Notify","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"tts","service":"cloud_say","entityId":"media_player.office_display","data":"{\"message\":\"Someone is at the front door\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":660,"y":300,"wires":[[]]},{"id":"953f4576.faa588","type":"ha-get-entities","z":"a3073265.18cb2","server":"6954ffe6.b584c","name":"Get States","rules":[{"property":"entity_id","logic":"is","value":"light.cabinet","valueType":"str"}],"output_type":"array","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":410,"y":620,"wires":[["d669a5a2.70ebf8"]]},{"id":"915c3c9d.448b","type":"api-call-service","z":"a3073265.18cb2","name":"Restore State","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet","data":"{\t   \"brightness\": payload.attributes.brightness,\t   \"hs_color\": payload.attributes.hs_color\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1060,"y":460,"wires":[["49937176.e2aec"]]},{"id":"bbe8e8b2.3c7a58","type":"api-call-service","z":"a3073265.18cb2","name":"Flash Lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet","data":"{\"brightness\":255,\"transition\":0,\"hs_color\":[360,100],\"flash\":\"short\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":460,"wires":[["e15c7a67.4a9808"]]},{"id":"e15c7a67.4a9808","type":"stoptimer","z":"a3073265.18cb2","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":850,"y":460,"wires":[["915c3c9d.448b"],[]]},{"id":"72a84563.c2fe6c","type":"switch","z":"a3073265.18cb2","name":"Filter Doorbell","property":"payload.event.device_id","propertyType":"msg","rules":[{"t":"eq","v":"9d8105f724dc536601acaa2daf3cef79","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":100,"wires":[["7163de00.5c2b44"]]},{"id":"7163de00.5c2b44","type":"switch","z":"a3073265.18cb2","name":"Filter Event Type","property":"payload.event.type","propertyType":"msg","rules":[{"t":"eq","v":"doorbell_chime","vt":"str"},{"t":"eq","v":"camera_person","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":100,"wires":[["e27df6a8.58ad38"],["e27df6a8.58ad38"]]},{"id":"a69aa10c.620ea","type":"inject","z":"a3073265.18cb2","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":400,"wires":[["c1c9ff4.908b4"]]},{"id":"d0ab445a.f183b8","type":"subflow:697063ce.0b394c","z":"ebca2dd1.3553a","name":"","env":[],"x":420,"y":320,"wires":[["9492d8da.cf6a88"],["f6e3200c.a8995"]]},{"id":"a6f6dae3.c814a8","type":"subflow:697063ce.0b394c","z":"ebca2dd1.3553a","x":420,"y":460,"wires":[["c67c5974.ce61c8"],["f6e3200c.a8995"]]},{"id":"131b3cae.48f863","type":"api-call-service","z":"697063ce.0b394c","name":"Vacuum return home","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"vacuum_action","entityId":"","data":"{\"command\": \"dock\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1260,"y":360,"wires":[[]]},{"id":"9492d8da.cf6a88","type":"subflow:f8cf226d.22997","z":"ebca2dd1.3553a","x":610,"y":280,"wires":[["c67c5974.ce61c8"],["f6e3200c.a8995"]]},{"id":"de47df09.8634e","type":"api-call-service","z":"697063ce.0b394c","name":"Dock","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"vacuum_action","entityId":"","data":"{\"command\": \"dock\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":300,"wires":[["6b1d28a2.facf28"]]},{"id":"6b1d28a2.facf28","type":"ha-wait-until","z":"697063ce.0b394c","name":"Wait till vacuum ready","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.vacuum","entityIdFilterType":"exact","property":"state","comparator":"is","value":"Ready","valueType":"str","timeout":"5","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":780,"y":300,"wires":[["4ffb921f.584bdc"],["131b3cae.48f863"]]},{"id":"b537487a.571488","type":"api-call-service","z":"f8cf226d.22997","name":"Dock","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"mop_action","entityId":"","data":"{\"command\": \"dock\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":280,"wires":[["69d62b36.d264c4"]]},{"id":"69d62b36.d264c4","type":"ha-wait-until","z":"f8cf226d.22997","name":"Wait till mop ready","server":"6954ffe6.b584c","outputs":2,"entityId":"sensor.mop","entityIdFilterType":"exact","property":"state","comparator":"is","value":"Ready","valueType":"str","timeout":"5","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":750,"y":280,"wires":[["b239385e.cc1ef8"],["bba00f31.d2b09"]]},{"id":"c461cfc3.87a8c","type":"trigger-state","z":"7bd9273e.d66c58","name":"Alarm State Changed","server":"6954ffe6.b584c","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"alarm_control_panel.abode_alarm","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"unavailable","propertyValue":"old_state.state"}],"outputs":5,"customoutputs":[{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"armed_away","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"},{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"armed_home","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"},{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"disarmed","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"}],"outputinitially":false,"state_type":"str","x":120,"y":320,"wires":[["673577ba.bacbb8"],["8792cc34.f1d31"],["d1b4c956.3dfb48","53992844.1fd638","8c7e3de4.bd124","8f9d70a1.64785","53c09520.35871c"],["d1b4c956.3dfb48","53992844.1fd638"],["febe1324.8e1ee","6ee2bd7c.6f0714"]]},{"id":"d1b4c956.3dfb48","type":"subflow:72891f2a.4e292","z":"7bd9273e.d66c58","name":"","env":[],"x":520,"y":229,"wires":[]},{"id":"fe5e9b23.c3ac58","type":"subflow:ebca2dd1.3553a","z":"7bd9273e.d66c58","name":"","env":[],"x":800,"y":469,"wires":[]},{"id":"8c7e3de4.bd124","type":"api-call-service","z":"7bd9273e.d66c58","name":"Turn off TV","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"media_player.samsung_tv_remote","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":490,"y":409,"wires":[[]]},{"id":"53992844.1fd638","type":"api-call-service","z":"7bd9273e.d66c58","name":"Lock Mudroom","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"lock","service":"lock","entityId":"lock.mud_room_lock","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":500,"y":289,"wires":[[]]},{"id":"8f9d70a1.64785","type":"api-call-service","z":"7bd9273e.d66c58","name":"Turn off downstairs lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.cabinet, light.kitchen_dimmer","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":530,"y":469,"wires":[["fe5e9b23.c3ac58"]]},{"id":"53c09520.35871c","type":"api-call-service","z":"7bd9273e.d66c58","name":"Turn off bedroom lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.jamis_bedside_lamp, switch.toms_bedside_lamp","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":520,"y":529,"wires":[[]]},{"id":"6ee2bd7c.6f0714","type":"api-call-service","z":"7bd9273e.d66c58","name":"Unlock Mudroom","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"lock","service":"unlock","entityId":"lock.mud_room_lock","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":510,"y":709,"wires":[[]]},{"id":"febe1324.8e1ee","type":"time-range-switch","z":"7bd9273e.d66c58","name":"","lat":"40.2581","lon":"-75.7263","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":0,"endOffset":0,"x":530,"y":649,"wires":[["1dc92d1c.0dcd73"],[]]},{"id":"1dc92d1c.0dcd73","type":"api-call-service","z":"7bd9273e.d66c58","name":"Turn on lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet, light.kitchen_dimmer","data":"{ \"brightness_pct\": 50 }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":800,"y":649,"wires":[[]]},{"id":"66af39c3.26f6a8","type":"api-call-service","z":"7bd9273e.d66c58","name":"Set alarm to standby","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_disarm","entityId":"alarm_control_panel.wrapped_alarm","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":300,"y":40,"wires":[[]]},{"id":"c5180f2d.025b3","type":"api-call-service","z":"7bd9273e.d66c58","name":"Set alarm to standby","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_disarm","entityId":"alarm_control_panel.wrapped_alarm","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":617,"y":940,"wires":[[]]},{"id":"69d6b4bf.8eba8c","type":"api-call-service","z":"7bd9273e.d66c58","name":"Set alarm to away","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_arm_away","entityId":"alarm_control_panel.wrapped_alarm","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":607,"y":860,"wires":[[]]},{"id":"870533a.eb8cfd","type":"comment","z":"7bd9273e.d66c58","name":"Disarm events","info":"","x":490,"y":609,"wires":[]},{"id":"60cd514e.04fea","type":"comment","z":"7bd9273e.d66c58","name":"Away events","info":"","x":490,"y":369,"wires":[]},{"id":"acc49b1c.2daf68","type":"comment","z":"7bd9273e.d66c58","name":"Home/Away events","info":"","x":510,"y":189,"wires":[]},{"id":"31a09e5c.f51442","type":"api-call-service","z":"3624fd34.85cb02","name":"Set alarm to away","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"alarm_control_panel","service":"alarm_arm_away","entityId":"alarm_control_panel.abode_alarm","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":220,"wires":[[]]},{"id":"673577ba.bacbb8","type":"api-call-service","z":"7bd9273e.d66c58","name":"Notify Success","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_toms_iphone","entityId":"","data":"{\t  \"message\": $$.payload,\t  \"title\": \"Alarm State Changed\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":500,"y":80,"wires":[[]]},{"id":"8792cc34.f1d31","type":"api-call-service","z":"7bd9273e.d66c58","name":"Notify Failed","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_toms_iphone","entityId":"","data":"{\t  \"message\": $$.payload,\t  \"title\": \"Alarm State Failed\"\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":490,"y":140,"wires":[[]]},{"id":"9de72cf8.c370e","type":"api-current-state","z":"697063ce.0b394c","name":"Vacuum State","server":"6954ffe6.b584c","version":1,"outputs":1,"halt_if":"","halt_if_type":"jsonata","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.vacuum","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":400,"y":40,"wires":[["c9a35899.98f878"]]},{"id":"c9a35899.98f878","type":"switch","z":"697063ce.0b394c","name":"Is Ready","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Ready","vt":"str"},{"t":"neq","v":"Ready","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":120,"y":220,"wires":[["4ffb921f.584bdc"],["b112a592.6fca98"]]},{"id":"591d81fc.f6d56","type":"api-call-service","z":"f8cf226d.22997","name":"Turn on lights","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet, light.kitchen_dimmer","data":"{ \"brightness_pct\": 50 }","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":220,"y":40,"wires":[["743759df.792d98"]]},{"id":"743759df.792d98","type":"api-current-state","z":"f8cf226d.22997","name":"Mop State","server":"6954ffe6.b584c","version":1,"outputs":1,"halt_if":"","halt_if_type":"jsonata","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.mop","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":420,"y":40,"wires":[["38fa842c.679a7c"]]},{"id":"38fa842c.679a7c","type":"switch","z":"f8cf226d.22997","name":"Is Ready","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Ready","vt":"str"},{"t":"neq","v":"Ready","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":120,"y":220,"wires":[["b239385e.cc1ef8"],["43546c35.52f4f4"]]},{"id":"b112a592.6fca98","type":"api-call-service","z":"697063ce.0b394c","name":"Stop","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"vacuum_action","entityId":"","data":"{\"command\": \"stop\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":290,"y":300,"wires":[["35445546.566c7a"]]},{"id":"35445546.566c7a","type":"delay","z":"697063ce.0b394c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":440,"y":300,"wires":[["de47df09.8634e"]]},{"id":"43546c35.52f4f4","type":"api-call-service","z":"f8cf226d.22997","name":"Stop","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"rest_command","service":"mop_action","entityId":"","data":"{\"command\": \"stop\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":270,"y":280,"wires":[["4718a3b8.11902c"]]},{"id":"4718a3b8.11902c","type":"delay","z":"f8cf226d.22997","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":420,"y":280,"wires":[["b537487a.571488"]]},{"id":"d669a5a2.70ebf8","type":"switch","z":"a3073265.18cb2","name":"Is Light On","property":"payload[0].state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":620,"wires":[["bbe8e8b2.3c7a58"],["6740f19a.a9b3f"]]},{"id":"9b8ab54e.625088","type":"api-call-service","z":"a3073265.18cb2","name":"Turn On Light","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.cabinet","data":"{}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":400,"y":900,"wires":[["2f8a0af3.f01d46"]]},{"id":"2f8a0af3.f01d46","type":"ha-wait-until","z":"a3073265.18cb2","name":"Wait till on","server":"6954ffe6.b584c","outputs":2,"entityId":"light.cabinet","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","entityLocation":"","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":610,"y":900,"wires":[["953f4576.faa588"],["a069f2e.8b6cc1"]]},{"id":"e27df6a8.58ad38","type":"switch","z":"a3073265.18cb2","name":"Is Running","property":"running","propertyType":"flow","rules":[{"t":"false"},{"t":"istype","v":"undefined","vt":"undefined"}],"checkall":"true","repair":false,"outputs":2,"x":130,"y":240,"wires":[["80fbe9ff.8b3ce8"],["80fbe9ff.8b3ce8"]]},{"id":"80fbe9ff.8b3ce8","type":"change","z":"a3073265.18cb2","name":"Set running","rules":[{"t":"set","p":"running","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":240,"wires":[["e948afde.d49af","97824373.fa92f","c1c9ff4.908b4"]]},{"id":"6740f19a.a9b3f","type":"change","z":"a3073265.18cb2","name":"Set initial state to off","rules":[{"t":"set","p":"state","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":900,"wires":[["9b8ab54e.625088"]]},{"id":"4cda9f8e.3f5a7","type":"comment","z":"a3073265.18cb2","name":"Turn on light and try again","info":"","x":390,"y":860,"wires":[]},{"id":"a069f2e.8b6cc1","type":"change","z":"a3073265.18cb2","name":"Set not running","rules":[{"t":"set","p":"running","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1300,"y":900,"wires":[[]]},{"id":"49937176.e2aec","type":"switch","z":"a3073265.18cb2","name":"Was initially off?","property":"state","propertyType":"flow","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":920,"y":620,"wires":[["a32c5b63.aeee38"],["a069f2e.8b6cc1"]]},{"id":"a2e67943.600e98","type":"api-call-service","z":"a3073265.18cb2","name":"Turn Off","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.cabinet","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1320,"y":600,"wires":[["a069f2e.8b6cc1"]]},{"id":"a32c5b63.aeee38","type":"stoptimer","z":"a3073265.18cb2","duration":"2","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1140,"y":600,"wires":[["a2e67943.600e98"],[]]},{"id":"6015f81d.dbb588","type":"comment","z":"a3073265.18cb2","name":"Flash lights and restore color/brightness","info":"","x":850,"y":420,"wires":[]},{"id":"ae3cc4e1.4527f8","type":"comment","z":"a3073265.18cb2","name":"Turn off if it was initially off","info":"","x":1230,"y":560,"wires":[]},{"id":"2ed6dc54.676734","type":"comment","z":"a3073265.18cb2","name":"Only run if it's not running already","info":"","x":250,"y":280,"wires":[]},{"id":"c1c9ff4.908b4","type":"change","z":"a3073265.18cb2","name":"Set initial state to on","rules":[{"t":"set","p":"state","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":620,"wires":[["953f4576.faa588"]]},{"id":"e0c4e52b.5ac4a8","type":"server-events","z":"7bd9273e.d66c58","name":"Alarm Tasks Event","server":"6954ffe6.b584c","event_type":"alarm_tasks_no_arm","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":110,"y":440,"wires":[["d1b4c956.3dfb48","53992844.1fd638","8f9d70a1.64785","53c09520.35871c","8c7e3de4.bd124"]]},{"id":"4d0b47b5.e4b4b8","type":"server-state-changed","z":"7bd9273e.d66c58","name":"Abel's door opened","server":"6954ffe6.b584c","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.abel_s_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":110,"y":1060,"wires":[["25536421.64696c"],[]]},{"id":"25536421.64696c","type":"api-call-service","z":"7bd9273e.d66c58","name":"Notify","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"notify","service":"everyone","entityId":"","data":"{\"message\":\"Abel's door was opened\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":310,"y":1040,"wires":[[]]},{"id":"c89fe070.6367e","type":"comment","z":"7bd9273e.d66c58","name":"Contact Sensors","info":"","x":100,"y":1000,"wires":[]},{"id":"bf0630c8.368fb","type":"server-state-changed","z":"7bd9273e.d66c58","name":"Mail delivered","server":"6954ffe6.b584c","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.mailbox_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":90,"y":1140,"wires":[["fdfc3a52.5baae8"],["d679699d.6a5ef8"]]},{"id":"fdfc3a52.5baae8","type":"api-call-service","z":"7bd9273e.d66c58","name":"Notify","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"notify","service":"everyone","entityId":"","data":"{\"message\":\"Mail has been delivered\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":310,"y":1120,"wires":[[]]},{"id":"d679699d.6a5ef8","type":"api-call-service","z":"7bd9273e.d66c58","name":"Set boolean","server":"6954ffe6.b584c","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.mail_delivered","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":330,"y":1180,"wires":[[]]}]