- id: '1606676673191'
  alias: 'Proximity: Set Thermostats to Eco'
  description: Set thermostats to Eco if more than 20 miles away and traveling away
    from home.
  trigger:
  - platform: numeric_state
    entity_id: proximity.home
    above: 10
  - platform: state
    entity_id:
    - proximity.home
    attribute: dir_of_travel
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: proximity.home
      attribute: dir_of_travel
      state: towards
  - condition: numeric_state
    entity_id: proximity.home
    above: 10
  - condition: or
    conditions:
    - condition: state
      entity_id: climate.downstairs
      attribute: preset_mode
      state: none
    - condition: state
      entity_id: climate.upstairs
      attribute: preset_mode
      state: none
  action:
  - device_id: e74fe3309cf9ebdff5b8de50dc762cd2
    domain: climate
    entity_id: 9c57958aa4086eebc3c1c663f1dcfe64
    type: set_preset_mode
    preset_mode: eco
  - device_id: bce5cbf2a20b1630b3fcd0c39f29f7ad
    domain: climate
    entity_id: 0356f8a2d4516c53d1077d9dd81fea49
    type: set_preset_mode
    preset_mode: eco
  - service: notify.mobile_app_toms_iphone
    data:
      message: Thermostats have been set Eco mode
      title: Leaving Home
  mode: single
- id: '1606676792936'
  alias: 'Proximity: Set Thermostats to Normal'
  description: Set thermostats to Eco if more than 20 miles away and traveling towards
    from home.
  trigger:
  - platform: numeric_state
    entity_id: proximity.home
    below: 10
  - platform: state
    entity_id:
    - proximity.home
    attribute: dir_of_travel
    to: towards
  condition:
  - condition: numeric_state
    entity_id: proximity.home
    below: 10
  - condition: not
    conditions:
    - condition: state
      entity_id: proximity.home
      attribute: dir_of_travel
      state: away_from
  - condition: or
    conditions:
    - condition: state
      entity_id: climate.downstairs
      attribute: preset_mode
      state: eco
    - condition: state
      entity_id: climate.upstairs
      attribute: preset_mode
      state: eco
  action:
  - device_id: e74fe3309cf9ebdff5b8de50dc762cd2
    domain: climate
    entity_id: 9c57958aa4086eebc3c1c663f1dcfe64
    type: set_preset_mode
    preset_mode: none
  - device_id: bce5cbf2a20b1630b3fcd0c39f29f7ad
    domain: climate
    entity_id: 0356f8a2d4516c53d1077d9dd81fea49
    type: set_preset_mode
    preset_mode: none
  - service: notify.mobile_app_toms_iphone
    data:
      message: Thermostats have been set Normal mode
      title: Going Home
  mode: single
- id: '1607443386474'
  alias: Reset Motion Sensors
  description: ''
  trigger:
  - platform: state
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    entity_id:
    - binary_sensor.front_door_motion_sensor
    - binary_sensor.great_room_motion_sensor
    - binary_sensor.kitchen_motion_sensor
    - binary_sensor.basement_motion_sensor
    id: motion_detected
  - platform: homeassistant
    event: start
    id: ha_start
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - motion_detected
    then:
    - service: python_script.hass_entities
      data:
        action: set_state
        entity_id: '{{ trigger.entity_id }}'
        state: 'off'
    else:
    - delay: 00:01:00
    - service: python_script.hass_entities
      data:
        action: set_state
        entity_id: binary_sensor.front_door_motion_sensor
        state: 'off'
    - service: python_script.hass_entities
      data:
        action: set_state
        entity_id: binary_sensor.great_room_motion_sensor
        state: 'off'
    - service: python_script.hass_entities
      data:
        action: set_state
        entity_id: binary_sensor.kitchen_motion_sensor
        state: 'off'
    - service: python_script.hass_entities
      data:
        action: set_state
        entity_id: binary_sensor.basement_motion_sensor
        state: 'off'
  mode: queued
  max: 10
- id: '1607999948442'
  alias: Kitchen Motion Lights
  description: ''
  trigger:
  - platform: state
    from: 'off'
    to: 'on'
    entity_id: binary_sensor.basement_door_motion_sensor_occupancy
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: light.cabinet
      state: 'off'
    - condition: numeric_state
      entity_id: automation.kitchen_motion_lights
      attribute: current
      above: '0'
  action:
  - service: light.turn_on
    data: {}
    entity_id: light.cabinet
  - wait_for_trigger:
    - platform: state
      from: 'on'
      to: 'off'
      entity_id: binary_sensor.basement_door_motion_sensor_occupancy
  - delay: 00:02:00
  - service: light.turn_off
    data: {}
    entity_id: light.cabinet
  mode: restart
- id: 5338138641074509ac3d115c3132d868
  alias: Set Default Theme
  description: ''
  trigger:
  - event: start
    platform: homeassistant
  condition: []
  action:
  - data:
      name: Google Light and Dark Theme
      mode: dark
    service: frontend.set_theme
- id: '1617642446660'
  alias: Set Nest Motion Entities
  description: ''
  trigger:
  - platform: device
    device_id: 17221139504c939b70008ccefdd0be45
    domain: nest
    type: camera_motion
    variables:
      motion_entity: input_boolean.motion_abels_room
  - platform: device
    device_id: 071987be0fcc0f04e764fa87ef7cfa08
    domain: nest
    type: camera_motion
    variables:
      motion_entity: input_boolean.motion_front_door
  - platform: device
    device_id: 1147fbae5177cd1c188b10b78454dbb7
    domain: nest
    type: camera_motion
    variables:
      motion_entity: input_boolean.motion_reeves_room
  - platform: device
    device_id: a15c183382243d7f47e4dc6a3433ed8c
    domain: nest
    type: camera_motion
    variables:
      motion_entity: input_boolean.motion_morning_room
  - platform: device
    device_id: 0285fc92583747d2a75e96f29502995f
    domain: nest
    type: camera_motion
    variables:
      motion_entity: input_boolean.motion_ellis_room
  - platform: device
    device_id: c0275b210992e5c0d0ac22bbb39308e5
    domain: nest
    type: camera_motion
    variables:
      motion_entity: input_boolean.motion_basement
  condition: []
  action:
  - service: input_boolean.turn_on
    data:
      entity_id: '{{ motion_entity }}'
  - delay:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
  - service: input_boolean.turn_off
    data:
      entity_id: '{{ motion_entity }}'
  mode: queued
  max: 10
- id: '1618875855459'
  alias: 'Tag scan: Toggle Mudroom Lock'
  description: ''
  trigger:
  - platform: event
    event_type: tag_scanned
    context:
      user_id:
      - 7e537ada4de44808a33c00cbf425c4e0
      - 9c546e5ab33f47fcbd2103594668aaaf
    event_data:
      tag_id: a8c94b61-8c2e-4c4e-83ac-12320c6a94ab
  condition: []
  action:
  - service: "{% if is_state('lock.mud_room_lock', 'locked') %}\n  lock.unlock\n{%
      else %}\n  lock.lock\n{% endif %}\n"
    target:
      entity_id: lock.mud_room_lock
    data: {}
  mode: single
- id: '1618931661466'
  alias: 'Tag scan: Toggle Left Garage Door'
  description: ''
  trigger:
  - platform: event
    event_type: tag_scanned
    context:
      user_id:
      - 7e537ada4de44808a33c00cbf425c4e0
      - 9c546e5ab33f47fcbd2103594668aaaf
    event_data:
      tag_id: a8e180a9-678e-4725-9257-625425614d2a
  condition: []
  action:
  - service: cover.toggle
    target:
      entity_id: cover.left_garage_door
    data: {}
  mode: single
- id: '1618932628621'
  alias: 'Tag scan: Toggle Right Garage Door'
  description: ''
  trigger:
  - platform: event
    event_type: tag_scanned
    context:
      user_id:
      - 7e537ada4de44808a33c00cbf425c4e0
      - 9c546e5ab33f47fcbd2103594668aaaf
    event_data:
      tag_id: 3c9eae60-e72c-45e2-b4bc-8c1a92fc9820
  condition: []
  action:
  - service: cover.toggle
    data: {}
    target:
      entity_id: cover.right_garage_door
  mode: single
- id: shellies_announce
  alias: Shellies Announce
  trigger:
  - platform: homeassistant
    event: start
  - platform: time_pattern
    hours: /1
  action:
    service: mqtt.publish
    data:
      topic: shellies/command
      payload: announce
- id: shellies_discovery
  alias: Shellies Discovery
  trigger:
  - platform: mqtt
    topic: shellies/announce
  condition:
  - condition: template
    value_template: '{{ trigger.payload_json.gen is not defined }}'
  action:
  - service: python_script.shellies_discovery
    data:
      id: '{{ trigger.payload_json.id }}'
      mac: '{{ trigger.payload_json.mac }}'
      fw_ver: '{{ trigger.payload_json.fw_ver }}'
      model: '{{ trigger.payload_json.model }}'
      mode: '{{ trigger.payload_json.mode | default }}'
      host: '{{ trigger.payload_json.ip }}'
      shellyswitch25-3C6105E4C230:
        relay-0: light
        relay-1: light
        force_update_sensors: true
      shelly1-E8DB84ACA160:
        relay-0: light
        force_update_sensors: true
      shelly1-3C6105E3A4C2:
        relay-0: light
        force_update_sensors: true
      shelly1-3C6105E3A7C9:
        relay-0: light
        force_update_sensors: true
  mode: queued
  max: 999
- id: shellies_announce_gen2
  alias: Shellies Announce Gen2
  trigger:
  - platform: homeassistant
    event: start
  - platform: time_pattern
    hours: /1
  action:
  - variables:
      device_info_payload: '{{ {''id'': 1, ''src'':''shellies_discovery'', ''method'':''Shelly.GetConfig''}
        | to_json }}'
      device_ids:
      - shellies/shellyplugus-083af2019ca8
      - shellies/shellypluswdus-b48a0a1c700c
  - repeat:
      for_each: '{{ device_ids }}'
      sequence:
      - service: mqtt.publish
        data:
          topic: '{{ repeat.item }}/rpc'
          payload: '{{ device_info_payload }}'
- id: shellies_discovery_gen2
  alias: Shellies Discovery Gen2
  mode: queued
  max: 999
  trigger:
  - platform: mqtt
    topic: shellies_discovery/rpc
  action:
  - service: python_script.shellies_discovery_gen2
    data:
      id: '{{ trigger.payload_json.src }}'
      device_config: '{{ trigger.payload_json.result }}'
- id: '1644036755398'
  alias: 'Wake-on-LAN: Basement Projector'
  description: ''
  trigger:
  - platform: webostv.turn_on
    entity_id: media_player.basement_projector
  action:
  - service: wake_on_lan.send_magic_packet
    data:
      mac: B0:37:95:01:2B:92
      broadcast_address: 192.168.0.255
- id: '1645034312500'
  alias: Dryer Complete
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.dryer_dry_completed
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.alexa_media
    data:
      message: The dryer is done. You better get folding.
      target:
      - media_player.basement_echo
      - media_player.kitchen_echo_show
      - media_player.bedroom_echo
      data:
        type: tts
  mode: single
- id: '1646407771689'
  alias: New version availabile
  description: ''
  trigger:
  - platform: state
    entity_id: update.home_assistant_core_update
    from: 'off'
    to: 'on'
  - platform: homeassistant
    event: start
  - platform: time
    at: '12:00:00'
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - condition: state
    entity_id: update.home_assistant_core_update
    state: 'on'
  - service: notify.mobile_app_toms_iphone
    data:
      title: HA v{{ states('sensor.home_assistant_website') }} is now available
      message: Currently running v{{ states('sensor.current_version') }}
      data:
        actions:
        - action: RELEASE_NOTES
          title: Open Release Notes
          uri: '{{ state_attr(''sensor.home_assistant_website'', ''release_notes'')
            }}'
        - action: UPDATE
          title: Update Version
          uri: /config/dashboard
  mode: single
- id: '1688434775547'
  alias: Low Battery Notification
  description: ''
  trigger:
  - platform: time
    at: 09:00:00
  condition: []
  action:
  - variables:
      threshold: 10
      sensors: "{% set result = namespace(sensors=[]) %} {% for state in states.sensor
        | selectattr('attributes.device_class', '==', 'battery') %}\n  {% if 0 <=
        state.state | int(-1) < threshold %}\n    {% set name = state.name | replace('
        battery', '') %}\n    {% set result.sensors = result.sensors + [name ~ ' ('
        ~ state.state ~ ' %)'] %}\n  {% endif %}\n{% endfor %} {% for state in states.binary_sensor
        | selectattr('attributes.battery_low', '==', true) %}\n  {% set result.sensors
        = result.sensors + [state.name] %}\n{% endfor %} {{result.sensors | sort |
        join(', ')}}"
  - condition: template
    value_template: '{{ sensors != '''' }}'
  - service: notify.mobile_app_toms_iphone
    data:
      title: Low Battery
      message: '{{sensors}}

        '
      data:
        url: /lovelace/battery-alert
  mode: single
- id: '1688667415109'
  alias: Control Blinds with Button
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.basement_blind_button_action
  condition: []
  action:
  - if:
    - condition: template
      value_template: '{{ trigger.to_state.state == ''open'' }}

        '
    then:
    - service: cover.open_cover
      data: {}
      target:
        device_id: e83194d36344b6a7628d6173595e0447
    else:
    - if:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''close'' }}'
      then:
      - service: cover.close_cover
        data: {}
        target:
          device_id: e83194d36344b6a7628d6173595e0447
  mode: single
- id: '1688856626822'
  alias: Vacuum/mop status update
  description: ''
  trigger:
  - platform: state
    entity_id:
    - vacuum.basement_roomba
    - vacuum.greatroom_roomba
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition:
  - condition: template
    value_template: '{{ trigger.from_state.state != trigger.to_state.state and (trigger.to_state.state
      == ''error'' or trigger.to_state.state == ''docked'') }}'
  action:
  - variables:
      name: '{{ trigger.to_state.name }}'
      status: '{{ trigger.to_state.attributes.status }}'
      errorEntity: '{{ trigger.entity_id | replace(''vacuum.'', ''input_boolean.'')
        }}_error'
      message: "{% if trigger.to_state.state == 'docked' %}\n  {% if is_state(errorEntity,
        'on') %}\n    {{ name }} has been returned to the dock ({{ status }})\n  {%
        elif status == 'Docking - End Mission' %}\n    {{ name }} is finished but
        ended it's mission early\n  {% else %}\n    {{ name }} has finished successfully
        ({{ status }})\n  {% endif %}\n{% else %}\n  {% if status == 'Stuck' %}\n
        \   {{ name }} is stuck\n  {% elif status == 'Base Unplugged' %}\n    The
        base for {{ name }} is unplugged, so it cannot charge\n  {% else %}\n    {{
        name }} couldn't complete the job ({{ status }})\n  {% endif %}\n{% endif
        %}\n"
  - service: notify.mobile_app_toms_iphone
    data:
      title: '{{ name }}'
      message: '{{ message }}'
  - if:
    - condition: template
      value_template: '{{ trigger.to_state.state == ''docked'' }}'
    then:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: '{{ errorEntity }}'
    else:
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: '{{ errorEntity }}'
  mode: single
- id: '1688913235675'
  alias: Vacuum bin full notification
  description: ''
  trigger:
  - platform: state
    entity_id:
    - vacuum.basement_roomba
    - vacuum.greatroom_roomba
    attribute: status
    from: 'false'
    to: 'true'
  condition: []
  action:
  - service: notify.mobile_app_toms_iphone
    data:
      message: '{{ trigger.from_state.name }}''s bin is full'
  mode: single
- id: '1689002155415'
  alias: Kitchen Light Remote
  description: ''
  trigger:
  - platform: mqtt
    topic: zigbee2mqtt/Remote/action
  condition:
  - condition: template
    value_template: '{{ ''_press_release'' not in trigger.payload }}'
  action:
  - variables:
      payload: '{{ trigger.payload }}'
      serviceName: "{% if payload == 'off_press' or payload == 'off_hold_release'
        %}\n  light.turn_off\n{% else %}\n  light.turn_on\n{% endif %}\n"
      serviceData: "{% if payload == 'up_press' or payload == 'up_hold' %}\n  { \"brightness_step_pct\":
        10 }\n{% elif payload == 'down_press' or payload == 'down_hold' %}\n  { \"brightness_step_pct\":
        -10 }\n{% else %}\n  {}\n{% endif %}\n"
  - service: '{{ serviceName }}'
    data: '{{ serviceData }}'
    target:
      entity_id: light.cabinet
  mode: queued
  max: 10
- id: '1689010045910'
  alias: Mail Delivered event handler
  description: ''
  trigger:
  - platform: event
    event_type:
    - mobile_app_notification_action
    - ios.action_fired
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.action == ''MAIL_RETRIEVED'' or trigger.event.data.actionName
      == ''MAIL_RETRIEVED'' }}'
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.mail_delivered
  mode: single
- id: '1689010572552'
  alias: Dismiss Alert event handler
  description: ''
  trigger:
  - platform: event
    event_type:
    - mobile_app_notification_action
    - ios.action_fired
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.action == ''DISMISS_ALERT'' or trigger.event.data.actionName
      == ''DISMISS_ALERT'' }}'
  action:
  - service: alert.turn_off
    data: {}
    target:
      entity_id: '{{ trigger.event.action_data.entity_id }}'
  mode: single
- id: '1689010815681'
  alias: Turn on porch & driveway lights
  description: ''
  trigger:
  - platform: sun
    event: sunset
    offset: 0
    id: sunset
  - platform: sun
    event: sunrise
    offset: 0
    id: sunrise
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - sunset
    then:
    - service: light.turn_on
      data: {}
      target:
        entity_id:
        - light.porch_lights
        - light.driveway_lights
    else:
    - service: light.turn_off
      data: {}
      target:
        entity_id:
        - light.porch_lights
        - light.driveway_lights
  mode: single
- id: '1689021667956'
  alias: Door sensor notifications
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.abels_door_contact
    - binary_sensor.reeves_door_contact
    - binary_sensor.basement_egress_window
    from: 'off'
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_boolean.abels_door_notification
        state: 'on'
      - condition: template
        value_template: '{{ trigger.entity_id == ''binary_sensor.abels_door_contact''
          }}'
    - condition: and
      conditions:
      - condition: state
        entity_id: input_boolean.reeves_door_notification
        state: 'on'
      - condition: template
        value_template: '{{ trigger.entity_id == ''binary_sensor.reeves_door_contact''
          }}'
    - condition: template
      value_template: '{{ trigger.entity_id == ''binary_sensor.basement_egress_window''
        }}'
  action:
  - variables:
      name: '{{ trigger.from_state.name | replace('' contact'', '''') }}'
      cameraEntity: "{% if trigger.entity_id == 'binary_sensor.abels_door_contact'
        %}\n    camera.abels_room\n{% elif trigger.entity_id == 'binary_sensor.reeves_door_contact'
        %}\n  camera.reeves_room\n{% else %}\n  camera.basement\n{% endif %}\n"
  - service: notify.everyone
    data:
      message: '{{ name }} was opened'
      data:
        entity_id: '{{ cameraEntity }}'
  - service: notify.alexa_media
    data:
      message: '{{ name }} was opened'
      target:
      - media_player.basement_echo
      - media_player.bedroom_echo
      - media_player.kitchen_echo_show
  mode: single
- id: '1689023119740'
  alias: Mail delivered
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.mailbox_contact
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.mail_delivered
  mode: single
- id: '1689023382014'
  alias: Auto Home
  description: ''
  trigger:
  - platform: zone
    entity_id: person.tom_fili
    zone: zone.auto_home
    event: enter
  - platform: zone
    entity_id: person.jami_fili
    zone: zone.auto_home
    event: enter
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: alarm_control_panel.wrapped_alarm
      state: disarmed
  action:
  - service: alarm_control_panel.alarm_disarm
    data: {}
    target:
      entity_id: alarm_control_panel.wrapped_alarm
  mode: single
- id: '1689027625322'
  alias: 'Event Handler: Arm Alarm'
  description: ''
  trigger:
  - platform: event
    event_type:
    - mobile_app_notification_action
    - ios.action_fired
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.action == ''ALARM_ARM'' or trigger.event.data.actionName
      == ''ALARM_ARM'' }}'
  action:
  - service: alarm_control_panel.alarm_arm_away
    data: {}
    target:
      entity_id: alarm_control_panel.wrapped_alarm
  mode: single
- id: '1689097272905'
  alias: 'Event Handler: Close Garage Doors'
  description: ''
  trigger:
  - platform: event
    event_type:
    - mobile_app_notification_action
    - ios.action_fired
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.action == ''GARAGE_CLOSE'' or trigger.event.data.actionName
      == ''GARAGE_CLOSE'' }}'
  action:
  - service: script.close_garage_doors
    data: {}
  mode: single
- id: '1689179755919'
  alias: Shutdown HA when running out of battery
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.apc_battery_charge
    below: 10
  condition:
  - condition: template
    value_template: '{{ ''DISCHRG'' in sensor.apc_status_data }}'
  action:
  - service: hassio.host_shutdown
    data: {}
  mode: single
- id: '1689186557347'
  alias: Alarm disarmed
  description: ''
  trigger:
  - platform: state
    entity_id:
    - alarm_control_panel.wrapped_alarm
    to: disarmed
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition:
  - condition: template
    value_template: '{{ trigger.from_state is not none and trigger.from_state.state
      != ''unavailable'' }}'
  action:
  - parallel:
    - service: lock.unlock
      data: {}
      target:
        entity_id: lock.mud_room_lock
    - if:
      - condition: state
        entity_id: sun.sun
        state: below_horizon
      then:
      - service: light.turn_on
        data:
          brightness_pct: 50
        target:
          entity_id:
          - light.cabinet
          - light.kitchen_dimmer
    - service: notify.everyone
      data:
        title: Alarm State Changed
        message: Disarmed
        data:
          actions:
          - identifier: OPEN_RIGHT_GARAGE_DOOR
            title: Open Right Garage Door
            authenticationRequired: true
          - identifier: OPEN_LEFT_GARAGE_DOOR
            title: Open Left Garage Door
            authenticationRequired: true
          - identifier: NOTHING
            title: Nothing
            authenticationRequired: false
  mode: single
- id: '1689187420027'
  alias: 'Wake-on-LAN: Greatroom TV'
  description: ''
  trigger:
  - platform: samsungtv.turn_on
    entity_id: media_player.greatroom_tv
  condition: []
  action:
  - service: wake_on_lan.send_magic_packet
    data:
      broadcast_port: 9
      mac: 10:2B:41:89:E8:54
      broadcast_address: 192.168.0.255
  mode: single
- id: '1689189186005'
  alias: Alarm armed
  description: ''
  trigger:
  - platform: state
    entity_id:
    - alarm_control_panel.wrapped_alarm
    to: armed_away
  - platform: state
    entity_id:
    - alarm_control_panel.wrapped_alarm
    to: armed_home
  - platform: event
    event_type: alarm_tasks_no_arm
  condition:
  - condition: template
    value_template: '{{ trigger.platform == ''event'' or (trigger.platform == ''state''
      and trigger.from_state is not none and trigger.from_state.state != ''unavailable'')
      }}'
  action:
  - variables:
      title: "{% if trigger.platform == 'event' %}\n  Alarm Actions\n{% else %}\n
        \ Alarm State Changed\n{% endif %}\n"
      message: "{% if trigger.platform == 'event' %}\n  What do you want to clean?\n{%
        else %}\n  {{ trigger.to_state.state | replace('armed_', '') | title }}\n{%
        endif %}\n"
  - parallel:
    - service: lock.lock
      data: {}
      target:
        entity_id: lock.mud_room_lock
    - service: script.close_garage_doors
      data: {}
    - service: notify.everyone
      data:
        title: '{{ title }}'
        message: '{{ message }}'
        data:
          actions:
          - identifier: VACUUM
            title: Vacuum
            authenticationRequired: true
          - identifier: VACUUM_AND_MOP
            title: Vacuum and Mop
            authenticationRequired: true
          - identifier: NOTHING
            title: Nothing
            authenticationRequired: false
    - if:
      - condition: template
        value_template: '{{ trigger.platform == ''event'' or (trigger.platform ==
          ''state'' and trigger.to_state.state == ''armed_away'') }}'
      then:
      - parallel:
        - service: light.turn_off
          data: {}
          target:
            entity_id:
            - light.basement_lights
            - light.kitchen_dimmer
            - light.cabinet
        - service: remote.send_command
          data:
            num_repeats: 1
            delay_secs: 0.4
            hold_secs: 0
            command: KEY_HOME
          target:
            entity_id: remote.greatroom_tv
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - service: media_player.turn_off
        data: {}
        target:
          entity_id:
          - media_player.bar_tv
          - media_player.basement_projector
          - media_player.gym_tv
          - media_player.office_tv
          - media_player.greatroom_tv
  mode: single
- id: '1689552243582'
  alias: 'Event Handler: Vacuum/Mop'
  description: ''
  trigger:
  - platform: event
    event_type:
    - mobile_app_notification_action
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.action == ''VACUUM_AND_MOP'' or trigger.event.data.action
      == ''VACUUM'' }}'
  action:
  - service: light.turn_on
    data:
      brightness_pct: 50
    target:
      entity_id:
      - light.cabinet
      - light.kitchen_dimmer
  - service: script.start_vacuum_or_mop
    data:
      entity_id: vacuum.greatroom_roomba
    response_variable: vacuum_success
  - if:
    - condition: template
      value_template: '{{ vacuum_success and  trigger.event.data.action == ''VACUUM_AND_MOP''
        }}'
    then:
    - service: script.start_vacuum_or_mop
      data: {}
      enabled: false
      response_variable: final_success
    - variables:
        final_success: '{{ vacuum_success }}'
        comment: This is temporary until the mop is working. Enable the above and
          delete this.
    else:
    - variables:
        final_success: '{{ vacuum_success }}'
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    data: {}
    target:
      entity_id:
      - light.cabinet
      - light.kitchen_dimmer
  mode: single
- id: '1689557717000'
  alias: Doorbell
  description: ''
  trigger:
  - platform: event
    event_type: nest_event
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.device_id == ''071987be0fcc0f04e764fa87ef7cfa08''
      and (trigger.event.data.type == ''doorbell_chime'' or trigger.event.data.type
      == ''camera_person'') }}'
  action:
  - variables:
      light_state: '{{ states(''light.cabinet'') }}'
  - parallel:
    - service: notify.alexa_media
      data:
        target:
        - media_player.basement_echo
        - media_player.bedroom_echo
        - media_player.kitchen_echo_show
        data:
          type: tts
        message: '"Someone is at the front door"'
    - service: media_player.play_media
      data:
        media_content_id: Show front door
        media_content_type: custom
      target:
        entity_id: media_player.kitchen_echo_show
    - if: []
      then:
      - service: tts.cloud_say
        data:
          cache: true
          entity_id: media_player.office_display
          message: Someone is at the front door
      - wait_for_trigger:
        - platform: state
          entity_id:
          - media_player.office_display
          to:
          - 'off'
          - idle
        timeout:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: camera.play_stream
        data:
          media_player: media_player.office_display
        target:
          entity_id: camera.front_door
    - if: []
      then:
      - if:
        - condition: state
          entity_id: light.cabinet
          state: 'off'
        then:
        - service: light.turn_on
          data: {}
          target:
            entity_id: light.cabinet
        - delay:
            hours: 0
            minutes: 0
            seconds: 1
            milliseconds: 0
      - variables:
          brightness: '{{ state_attr(''light.cabinet'', ''brightness'') }}'
          color:
          - '{{ state_attr(''light.cabinet'', ''color'').x }}'
          - '{{ state_attr(''light.cabinet'', ''color'').y }}'
      - service: light.turn_on
        data:
          rgb_color:
          - 247
          - 2
          - 2
          brightness: 255
        target:
          entity_id: light.cabinet
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - service: light.turn_on
        data:
          xy_color: '{{ color }}'
          brightness: '{{ brightness }}'
        target:
          entity_id: light.cabinet
      - if:
        - condition: template
          value_template: '{{ light_state == ''off'' }}'
        then:
        - delay:
            hours: 0
            minutes: 0
            seconds: 2
            milliseconds: 0
        - service: light.turn_off
          data: {}
          target:
            entity_id: light.cabinet
  mode: single
- id: '1689561875523'
  alias: Cesium Meeting
  description: ''
  trigger:
  - platform: calendar
    event: start
    offset: -0:1:0
    entity_id: calendar.tom_cesium_com
    id: calendar_meeting
  - platform: webhook
    allowed_methods:
    - POST
    - PUT
    local_only: true
    webhook_id: q4fryupTsZLO8QE5MIyp6ekXzohLkjmb
  condition: []
  action:
  - parallel:
    - if:
      - condition: state
        entity_id: media_player.office_tv
        state:
        - playing
        - unavailable
      then:
      - service: media_player.media_pause
        data: {}
        target:
          entity_id: media_player.office_tv
    - if:
      - condition: trigger
        id:
        - calendar_meeting
      then:
      - service: tts.cloud_say
        data:
          cache: false
          entity_id: media_player.office_display
          message: '{{ trigger.calendar_event.summary }}'
  mode: single
- id: '1689562922595'
  alias: Office
  description: ''
  trigger:
  - platform: time
    at: 07:00:00
    id: start_work
  - platform: time
    at: '18:00:00'
    id: end_work
  - platform: state
    entity_id:
    - binary_sensor.office_motion_sensor_occupancy
    to: 'on'
    id: office_motion
  - platform: numeric_state
    entity_id: sensor.office_motion_sensor_illuminance_lux
    below: 25
    id: lux_below_25
  - platform: numeric_state
    entity_id: sensor.office_motion_sensor_illuminance_lux
    above: 40
    id: lux_above_40
  - platform: state
    entity_id:
    - binary_sensor.office_motion_sensor_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 30
      seconds: 0
    id: office_clear_for_30
  - platform: state
    entity_id:
    - sensor.office_motion_sensor_temperature
    id: temp_change
  - platform: state
    entity_id:
    - alarm_control_panel.wrapped_alarm
    to: armed_away
    id: alarm_away
  condition: []
  action:
  - variables:
      is_workday: '{{ now().weekday() < 5 and now().hour > 7 and now().hour < 18 }}'
  - if:
    - condition: trigger
      id:
      - lux_above_40
    - condition: state
      entity_id: light.office_ceiling_fan
      state: 'on'
    then:
    - service: light.turn_off
      data: {}
      target:
        entity_id: light.office_ceiling_fan
    - service: notify.mobile_app_toms_iphone
      data:
        title: Turn off light
        message: Lux {{ trigger.to_state.state }}
      enabled: false
  - if:
    - condition: or
      conditions:
      - condition: and
        conditions:
        - condition: trigger
          id:
          - lux_below_25
        - condition: template
          value_template: '{{ is_workday }}'
      - condition: and
        conditions:
        - condition: trigger
          id:
          - office_motion
          - start_work
        - condition: numeric_state
          entity_id: sensor.office_motion_sensor_illuminance_lux
          below: 25
    then:
    - service: light.turn_on
      data: {}
      target:
        entity_id: light.office_ceiling_fan
    - service: notify.mobile_app_toms_iphone
      data:
        title: Turn on light
        message: Lux {{ states(sensor.office_motion_sensor_illuminance_lux) }}
      enabled: false
  - if:
    - condition: trigger
      id:
      - end_work
      - office_clear_for_30
      - alarm_away
    - condition: or
      conditions:
      - condition: state
        entity_id: alarm_control_panel.wrapped_alarm
        state: armed_away
      - condition: and
        conditions:
        - condition: template
          value_template: '{{ not is_workday }}'
        - condition: state
          entity_id: binary_sensor.office_motion_sensor_occupancy
          state: 'off'
          for:
            hours: 0
            minutes: 30
            seconds: 0
    then:
    - service: media_player.turn_off
      data: {}
      target:
        entity_id: media_player.office_tv
    - service: fan.turn_off
      data: {}
      target:
        entity_id: fan.office_ceiling_fan
    - service: light.turn_off
      data: {}
      target:
        entity_id: light.office_ceiling_fan
    - service: notify.mobile_app_toms_iphone
      data:
        title: Turn off
        message: light & fan
      enabled: false
  - if:
    - condition: trigger
      id:
      - temp_change
      - start_work
      - office_motion
    then:
    - variables:
        temp: '{{ states(''sensor.office_motion_sensor_temperature'') }}'
        fan_speed: "{% if temp < 72 %}\n  0\n{% elif temp < 76 %}\n  33\n{% elif temp
          < 80 %}\n  66\n{% else %}\n  100\n{% endif %}\n  \n"
    - if:
      - condition: template
        value_template: '{{ fan_speed != state_attr(''fan.office_ceiling_fan'', ''percentage'')
          }}'
      then:
      - if:
        - condition: template
          value_template: '{{ fan_speed > 0 }}'
        - condition: or
          conditions:
          - condition: template
            value_template: '{{ is_workday }}'
          - condition: trigger
            id:
            - office_motion
        then:
        - service: fan.set_percentage
          data:
            percentage: '{{ fan_speed }}'
          target:
            entity_id: fan.office_ceiling_fan
        else:
        - service: fan.turn_off
          data: {}
          target:
            entity_id: fan.office_ceiling_fan
      - service: notify.mobile_app_toms_iphone
        data:
          title: Fan Speed Update
          message: '{{ fan_speed }} ({{ temp }}°)'
        enabled: false
  mode: single
- id: '1689773551816'
  alias: 'Event Handler: Open Garage Doors'
  description: ''
  trigger:
  - platform: event
    event_type:
    - mobile_app_notification_action
    - ios.action_fired
  condition:
  - condition: template
    value_template: "{{\n  trigger.event.data.action == 'OPEN_RIGHT_GARAGE_DOOR' or
      trigger.event.data.actionName == 'OPEN_RIGHT_GARAGE_DOOR' or\n  trigger.event.data.action
      == 'OPEN_LEFT_GARAGE_DOOR' or trigger.event.data.actionName == 'OPEN_LEFT_GARAGE_DOOR'
      or\n  trigger.event.data.action == 'OPEN_GARAGE_DOORS' or trigger.event.data.actionName
      == 'OPEN_GARAGE_DOORS'\n}}"
  action:
  - variables:
      action: "{% if trigger.event.data.action is defined %}\n  {{ trigger.event.data.action
        }}\n{% else %}\n  {{ trigger.event.data.actionName }}\n{% endif %}\n"
  - parallel:
    - if:
      - condition: template
        value_template: '{{ action == ''OPEN_RIGHT_GARAGE_DOOR'' or action == ''OPEN_GARAGE_DOORS''
          }}'
      then:
      - service: cover.open_cover
        data: {}
        target:
          entity_id: cover.wrapped_right_garage
    - if:
      - condition: template
        value_template: '{{ action == ''OPEN_LEFT_GARAGE_DOOR'' or action == ''OPEN_GARAGE_DOORS''
          }}'
      then:
      - service: cover.open_cover
        data: {}
        target:
          entity_id: cover.wrapped_left_garage
  mode: single
- id: '1690424019295'
  alias: Abode Test
  description: ''
  trigger:
  - platform: event
    event_type: abode_alarm
    event_data: {}
  - platform: event
    event_type: abode_alarm_end
    event_data: {}
  - platform: event
    event_type: abode_automation
    event_data: {}
  - platform: event
    event_type: abode_panel_fault
    event_data: {}
  - platform: event
    event_type: abode_panel_restore
    event_data: {}
  - platform: event
    event_type: abode_disarm
    event_data: {}
  - platform: event
    event_type: abode_arm
    event_data: {}
  - platform: event
    event_type: abode_arm_fault
    event_data: {}
  - platform: event
    event_type: abode_test
    event_data: {}
  - platform: event
    event_type: abode_capture
    event_data: {}
  - platform: event
    event_type: abode_device
    event_data: {}
  condition: []
  action:
  - event: '{{ trigger.event.event_type | replace(''abode'', ''alarm'') }}'
    event_data:
      device_id: '{{ trigger.event.data.device_id }}'
      device_name: '{{ trigger.event.data.device_name }}'
      device_type: '{{ trigger.event.data.device_type }}'
      event_code: '{{ trigger.event.data.event_code }}'
      event_name: '{{ trigger.event.data.event_name }}'
      event_type: '{{ trigger.event.data.event_type }}'
      event_utc: '{{ trigger.event.data.event_utc }}'
      user_name: '{{ trigger.event.data.user_name }}'
      app_type: '{{ trigger.event.data.app_type }}'
      event_by: '{{ trigger.event.data.event_by }}'
      date: '{{ trigger.event.data.date }}'
      time: '{{ trigger.event.data.time }}'
  mode: single
- id: '1691811863982'
  alias: Reset Ad Filter
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.ad_filter
    to: 'off'
  condition: []
  action:
  - wait_for_trigger:
    - platform: state
      entity_id:
      - switch.ad_filter
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    timeout:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - if:
    - condition: template
      value_template: '{{ wait.trigger == none }}'
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.ad_filter
    - service: notify.mobile_app_toms_iphone
      data:
        message: Ad Filter Set to On
      enabled: false
  mode: restart
- id: '1692025965540'
  alias: Watchman Report
  description: ''
  trigger:
  - platform: time
    at: 09:00:00
  condition: []
  action:
  - service: watchman.report
    data:
      create_file: true
      parse_config: false
      chunk_size: false
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - if:
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.watchman_missing_services
        above: 0
      - condition: numeric_state
        entity_id: sensor.watchman_missing_entities
        above: 0
    then:
    - service: notify.mobile_app_toms_iphone
      data:
        title: Watchman Report
        message: '{{ states(''sensor.watchman_missing_services'') }} missing services

          {{ states(''sensor.watchman_missing_entities'') }} missing entities

          '
  mode: single
- id: '1692210763472'
  alias: Low Battery Location Notification
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: device_tracker.toms_iphone
    attribute: battery_level
    below: 5
    id: tom
  - platform: numeric_state
    entity_id: device_tracker.jamis_iphone
    attribute: battery_level
    below: 5
    id: jami
  condition: []
  action:
  - variables:
      lowDevice: '{{ trigger.id }}'
      title: '{{ lowDevice | title }}''s Battery Low'
      location: '{{ states(''sensor.'' ~ lowDevice ~ ''s_location'') }}'
      service: "{% if lowDevice == \"tom\" %}\n  notify.mobile_app_jamis_iphone\n{%
        else %}\n  notify.mobile_app_toms_iphone\n{% endif %}\n"
  - service: '{{ service }}'
    data:
      title: '{{ title }}'
      message: 'Location: {{ location }}'
  mode: single
- id: '1693174368442'
  alias: 'Thermostat: Fan on when cooling'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - climate.downstairs
    - climate.upstairs
    attribute: fan_mode
    to: 'off'
  - platform: time_pattern
    minutes: /15
  condition: []
  action:
  - if:
    - condition: state
      entity_id: climate.downstairs
      state:
      - cool
      - heat_cool
    - condition: state
      entity_id: climate.downstairs
      attribute: fan_mode
      state: 'off'
    then:
    - service: climate.set_fan_mode
      data:
        fan_mode: 'on'
      target:
        device_id: e74fe3309cf9ebdff5b8de50dc762cd2
  - if:
    - condition: state
      entity_id: climate.upstairs
      state:
      - cool
      - heat_cool
    - condition: state
      entity_id: climate.upstairs
      attribute: fan_mode
      state: 'off'
    then:
    - service: climate.set_fan_mode
      data:
        fan_mode: 'on'
      target:
        device_id: bce5cbf2a20b1630b3fcd0c39f29f7ad
  mode: single
- id: '1703641301539'
  alias: Jami Home
  description: ''
  trigger:
  - platform: state
    entity_id:
    - person.jami_fili
    to: home
  condition: []
  action:
  - service: notify.mobile_app_toms_iphone
    data:
      message: Jami is home
  mode: single
